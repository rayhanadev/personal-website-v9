---
import NavBar from "./NavBar.astro";
import Link from "./Link.astro";

import Glider0 from "../assets/gliders/Glider0.svg";
import Glider1 from "../assets/gliders/Glider1.svg";
import Glider2 from "../assets/gliders/Glider2.svg";
import Glider3 from "../assets/gliders/Glider3.svg";

const gliders = [Glider0, Glider1, Glider2, Glider3];
---

<header class="w-full max-w-184 flex flex-col gap-4 sm:flex-row sm:gap-0 sm:justify-between sm:items-start font-sans mb-8 sm:mb-15 relative z-10">
  <div class="flex flex-col gap-3 sm:gap-4">
    <h1 class="text-[28px] leading-8.5 font-semibold">Ray Arayilakath</h1>
    <p class="text-base leading-5"><Link href="https://x.com/rayhanadev">@rayhanadev</Link> â€¢ Platform Engineer at <Link href="https://million.dev">Million</Link></p>
  </div>
  <div class="flex items-center justify-between gap-4 sm:flex-col-reverse sm:items-end">
    <NavBar />
    <a
      href="https://purduehackers.com"
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Purdue Hackers"
      class="glider-link size-8.25 absolute top-0 right-0 sm:relative block outline-none select-none"
      style={`--glider-mask: url("${Glider0.src}")`}
      transition:persist="glider"
      transition:animate="none"
    >
      <img src={gliders[0].src} alt="" draggable="false" loading="lazy" class="glider-frame size-8.25 absolute inset-0 opacity-0" />
      <img src={gliders[1].src} alt="" draggable="false" loading="lazy" class="glider-frame size-8.25 absolute inset-0 opacity-0" />
      <img src={gliders[2].src} alt="" draggable="false" loading="lazy" class="glider-frame size-8.25 absolute inset-0 opacity-0" />
      <img src={gliders[3].src} alt="" draggable="false" loading="lazy" class="glider-frame size-8.25 absolute inset-0" />
    </a>
  </div>
</header>

<script>
  const gliderLink = document.querySelector('.glider-link');
  const frames = gliderLink?.querySelectorAll('.glider-frame');
  if (frames?.length && !gliderLink?.classList.contains('ready')) {
    Promise.all(
      Array.from(frames).map(img => 
        (img as HTMLImageElement).complete 
          ? Promise.resolve() 
          : new Promise(resolve => { img.addEventListener('load', resolve, { once: true }); })
      )
    ).then(() => {
      gliderLink?.classList.add('loaded');
      setTimeout(() => {
        frames.forEach((frame, i) => {
          const el = frame as HTMLElement;
          el.style.animation = 'none';
          el.style.opacity = i === 0 ? '1' : '0';
        });
        gliderLink?.classList.add('ready');
      }, 2000);
    });
  }
</script>

<style>
  .glider-frame { transition: opacity 350ms ease; }

  .glider-link.loaded .glider-frame:nth-child(4) { animation: glider-frame-3 2s steps(1) forwards; }
  .glider-link.loaded .glider-frame:nth-child(3) { animation: glider-frame-2 2s steps(1) forwards; }
  .glider-link.loaded .glider-frame:nth-child(2) { animation: glider-frame-1 2s steps(1) forwards; }
  .glider-link.loaded .glider-frame:nth-child(1) { animation: glider-frame-0 2s steps(1) forwards; }

  .glider-link.ready:hover img, .glider-link.ready:focus img { opacity: 0; }

  .glider-link::after {
    content: "";
    position: absolute;
    inset: 0;
    background-color: #fbbf24;
    opacity: 0;
    transition: opacity 350ms ease;
    -webkit-mask: var(--glider-mask) center / contain no-repeat;
    mask: var(--glider-mask) center / contain no-repeat;
  }

  .glider-link.ready:hover::after, .glider-link.ready:focus::after { opacity: 1; }

  @media (prefers-reduced-motion: reduce) {
    .glider-frame { animation: none !important; transition: none; opacity: 1 !important; }
    .glider-frame:not(:first-child) { opacity: 0 !important; }
    .glider-link::after { transition: none; }
  }
</style>
